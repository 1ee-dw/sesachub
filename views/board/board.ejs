<!DOCTYPE html>
<html lang="ko">
<%- include('../include/include.ejs', {title:"Ïª§ÎÆ§ÎãàÌã∞"}); %>
    <link rel="stylesheet" href="/static/css/board.css">

    <body>
        <%- include('../include/header.ejs'); %>
            <% let isBookmarked=Object.keys(board.bookmarks).some(bookmarks=> bookmarks.u_id === session.u_id); %>
                <div class="container">
                    <div class="center">
                        <main role="main">
                            <div class="content board">
                                <!-- Î≥∏Î¨∏ ÏãúÏûë -->
                                <div id="board">
                                    <div class="table_box no_border">
                                        <table>
                                            <caption></caption>
                                            <colgroup>
                                                <col style="width:120px;">
                                                <col>
                                                <col style="width:120px;">
                                                <col>
                                            </colgroup>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">Ï†úÎ™©</th>
                                                    <td colspan="3">
                                                        <h2>
                                                            <%=board.title%>
                                                        </h2>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">ÏûëÏÑ±Ïûê</th>
                                                    <td rowspan="1">
                                                        <% if(board.profile_img){ %>
                                                            <img class="profile_img" src="/static/images/profile/'<%= board.profile_img  %>'" alt="ÌîÑÎ°úÌïÑ">
                                                            <% }else{ %>
                                                                <img class="profile_img" src="/static/images/logo.png" alt="ÌîÑÎ°úÌïÑ">
                                                            <% } %>
                                                        <%=board.user.nk_name%>
                                                    </td>
                                                    <th scope="row">ÏûëÏÑ±Ïùº</th>
                                                    <td rowspan="1">
                                                        <%=board.createdAt.toLocaleString('ko-KR', { year: 'numeric' ,
                                                            month: '2-digit' , day: '2-digit' , hourCycle:'h24',
                                                            hour:'2-digit',minute:'2-digit',second:'2-digit' })%>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">ÎÇ¥Ïö©</th>
                                                    <td colspan="3" class="board_content">
                                                        <%=board.content%>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="bottom_area">
                                        <div class="icon_box">
                                            <div class="like_box">
                                                <button type="button"
                                                    onclick="like('<%=board.b_id%>','<%=session.u_id%>')">ü§ç</button>
                                                <span id="like_count">
                                                    
                                                    <%= board.dataValues.like_count%>
                                                </span>
                                            </div>
                                            <div class="bookmark_box" class="btn_bookmark" id="check_bookmark">
                                                <!-- <span>Î∂ÅÎßàÌÅ¨</span> -->
                                                <% if (board.bookmarks && board.bookmarks.length > 0) { %>
                                                    <% for(let bookmark of board.bookmarks) { %>
                                                        <% if (bookmark.u_id === session.u_id) { %>
                                                            <a href="javascript:bookmark('<%=board.b_id%>','<%=session.u_id%>')"
                                                                id="bookmark">&#9733;</a>
                                                        <% } else { %>
                                                            <a href="javascript:bookmark('<%=board.b_id%>','<%=session.u_id%>')"
                                                                id="bookmark">&#9734;</a>
                                                        <% } %>
                                                    <% } %>
                                                <% } else { %>
                                                    <a href="javascript:bookmark('<%=board.b_id%>','<%=session.u_id%>')"
                                                        id="bookmark">&#9734;</a>
                                                <% } %>
                                              
                                             
                                            </div>
                                        </div>
                                        
                                        <div class="btn_wrap">
                                            <a href="javascript:page_update('<%=board.b_id%>');"
                                                class="btn basic">ÏàòÏ†ï</a>
                                            <a href="javascript:delete_board('<%=board.b_id%>');"
                                                class="btn delete">ÏÇ≠Ï†ú</a>
                                            <a href="/board" class="btn basic">Î™©Î°ùÏúºÎ°ú</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Î≥∏Î¨∏ ÎÅù -->
                                <!-- ÎåìÍ∏Ä ÏãúÏûë -->
                                <div class="comment_box">
                                    <!-- ÎåìÍ∏ÄÌèº Ìò∏Ï∂ú -->
                                    <form name="comment" class="cmt_form">
                                        <input type="hidden" name="b_id" value="<%=board.b_id%>" />
                                        <input type="hidden" name="u_id" value="<%=session.u_id%>" />
                                        <input type="hidden" name="nk_name" value="<%=session.nk_name%>" />
                                        <select name="status">
                                            <option value="public">Í≥µÍ∞ú</option>
                                            <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                                        </select>
                                        <textarea name="comment_content" rows="3" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
                                        <input type="button" class="btn" onclick="comment_insert()" value="ÎåìÍ∏Ä ÏûëÏÑ±">
                                    </form>
                                    <!-- ÎåìÍ∏Ä Î™©Î°ù -->
                                    <ul class="cmt_list">
                                        <!-- Ïõê ÎåìÍ∏Ä ÏãúÏûë -->
                                        <% for(comment of board.comments) {%>
                                            <li id="cmt<%=comment.c_id%>_wrap">
                                                <div class="cmt_top">
                                                    <div class="cmt_nm">
                                                        <span>
                                                            <%=comment.nk_name%>
                                                        </span>
                                                    </div>
                                                    <div class="cmt_time">
                                                        <span><%=comment.createdAt.toLocaleString("ko-KR")%></span>
                                                    </div>
                                                    <select id="cmt<%=comment.c_id%>_status" style="display: none">
                                                        <option value="public">Í≥µÍ∞ú</option>
                                                        <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                                                    </select>
                                                </div>
                                                <div id="cmt<%=comment.c_id%>_content" class="cmt_content">
                                                    <%=comment.content%>
                                                </div>
                                                <div class="cmt_bottom">
                                                    <% if (session.u_id===comment.u_id) {%>
                                                        <input type="button" id="cmt_update_btn<%=comment.c_id%>"
                                                            onclick="change_comment('<%=comment.c_id%>')"
                                                            value="ÎåìÍ∏Ä ÏàòÏ†ï" />
                                                        <input type="button" id="cmt_delete_btn<%=comment.c_id%>"
                                                            onclick="comment_delete('<%=comment.c_id%>')"
                                                            value="ÎåìÍ∏Ä ÏÇ≠Ï†ú" />
                                                        <%}%>
                                                            <input type="button" class="btn"
                                                                id="reply_btn<%=comment.c_id%>"
                                                                onclick="call_reply_form('<%=comment.c_id%>')"
                                                                value="ÎãµÍ∏Ä Ïì∞Í∏∞" />
                                                </div>
                                                <!-- Ïõê ÎåìÍ∏Ä ÎÅù -->
                                                <!-- ÎãµÍ∏Ä ÏãúÏûë -->
                                                <div class="cmt_reply">
                                                    <!-- ÎãµÍ∏Ä Ìèº Ìò∏Ï∂ú -->
                                                    <form name="reply_form<%=comment.c_id%>" style="display: none">
                                                        <input type="hidden" name="b_id" value="<%=board.b_id%>" />
                                                        <input type="hidden" name="u_id" value="<%=session.u_id%>" />
                                                        <input type="hidden" name="parent_id"
                                                            value="<%=comment.c_id%>" />
                                                        <input type="hidden" name="nk_name"
                                                            value="<%=session.nk_name%>" />
                                                        <select name="status">
                                                            <option value="public">Í≥µÍ∞ú</option>
                                                            <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                                                        </select>
                                                        <textarea name="reply_content" rows="3" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                                                            required></textarea>
                                                        <input type="button" id="reply_insert_btn" class="btn"
                                                            onclick="reply_insert('<%=comment.c_id%>')" value="ÎãµÍ∏Ä ÏûëÏÑ±" />
                                                    </form>
                                                    <!-- ÎãµÍ∏Ä Î™©Î°ù -->
                                                    <ul>
                                                        <% if (comment.replies.length> 0) {%>
                                                            <% for (reply of comment.replies) {%>
                                                                <li class="reply">
                                                                    ‚Üò
                                                                    <div class="reply_top">
                                                                        <input type="hidden"
                                                                            value="<%=reply.parent_id%>">
                                                                        <span>
                                                                            <%=reply.nk_name %>
                                                                        </span>
                                                                        <span><%=reply.createdAt.toLocaleString("ko-KR")%></span>
                                                                        <select id="cmt<%=reply.c_id%>_status"
                                                                            style="display:none">
                                                                            <option value="public">Í≥µÍ∞ú</option>
                                                                            <option value="private">ÎπÑÍ≥µÍ∞ú</option>
                                                                        </select>
                                                                    </div>
                                                                    <div id="cmt<%=reply.c_id%>_wrap">
                                                                        <span id="cmt<%=reply.c_id%>_content">
                                                                            <%=reply.content%>
                                                                        </span>
                                                                    </div>
                                                                    <div class="reply_btm">
                                                                        <% if (session.u_id===reply.u_id) {%>
                                                                            <input type="button"
                                                                                id="cmt_update_btn<%=reply.c_id%>"
                                                                                onclick="change_comment('<%=reply.c_id%>')"
                                                                                value="ÎåìÍ∏Ä ÏàòÏ†ï" />
                                                                            <input type="button"
                                                                                id="cmt_delete_btn<%=reply.c_id%>"
                                                                                onclick="comment_delete('<%=reply.c_id%>')"
                                                                                value="ÎåìÍ∏Ä ÏÇ≠Ï†ú" />
                                                                            <%}%>
                                                                    </div>
                                                                </li>
                                                                <%}%>
                                                                    <%}%>
                                                    </ul>
                                                </div>
                                                <!-- ÎãµÍ∏Ä ÎÅù -->
                                            </li>
                                            <%}%>
                                    </ul>
                                </div>
                                <!-- ÎåìÍ∏Ä ÎÅù -->
                            </div>
                        </main>
                    </div>
                </div>
                <script src="/static/js/board/board.js"></script>
    </body>

</html>